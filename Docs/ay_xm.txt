Очень предварительный консепт.1. General ConceptsВ панельку от АУ-3-8910.Эмулирует АУ и УМ по стандартной модели.ФМ синтез не планируется. По крайней мере в ближайшем будущем.Юзает набор доп регов 16-255.Цифровой звук 12 бит, не менее 44.1кГц, стерео.ХМ до 32 каналов со всеми фичами.Возможность плея цифрового эффекта в любой из 32 каналов.Возможность использования в качестве акселя.Алсо, в тсконфе я предусмотрю для ДМА АУ как одно из устройств. В обе стороны.Но работа зетником всегда возможна при отсутствии дмы.Имеет на борту ОЗУ, мин 512кб, макс 4мб, скока не жалко.Важный момент - защита от дурака на всех возможных уровнях для предотвращения неконтролируемого зависона.2. SignalingСигналы BC1 и BDIR выбирают режим Latch/Read/Write.По латчу - номер рега, по риду/райту - данные.Ресет АУ заведен на апп. ресет арма.По ресету арм должен быстренько приводить себя в состояние готовности АУ.Например, тестирование ОЗУ можно отложить на вейтовую по статусу командуперевода в состояние цифры или ХМ.3. Programming modelВсе те же порты FFFD и BFFD.Реги 0-15 АУ. В режиме АУ все как у АУ.Другие реги:Status (чтение)- Готовность принимать команду (рэди/бизи)- Готовность принимать дату (по идее, безвейтовый, проц должен дату быстро принимать, но мало ли)- Режим девайса (АУ/не АУ)- Статус (ошибка/не ошибка)етс.Расширенные статусы (чтение)- код ошибки- расширенное состояние- етцCommand (запись)Прежде чем слать че попало - проверяем статус.По состоянию статуса - знаем, что можно слать.Какие команды могут быть:- смена режима (АУ/аудио-дма/ХМ плеер)- управление режимами (загрузка/плей/стоп)Менеджер памяти внутренний.Перед загрузкой модуля/сэмпла необходимо указать размер, при превышении размера свободной памяти вылетаем с ошибкой в статусе.Предусмотреть удаление объектов с шринком хипа.Переменные, связанные с плеерами.- паттерн/нота/етцГромкости- глобальная (левый/правый)- для каждого из каналов в левое/правое ухо. 0-255. 64 рега. Возможно запилить в виде 2х регов: номер канала/уха + громкость.Версия (чтение)После записи номера этого рега выдается хз скока байт стринга в кастомном формате,содержащим инфу про девайс.4. Output audio12-бит ЦАП достаточен. Алсо, 12 бит всю жизнь было на расово копирастных ЦэДэ.Стерео. Дискретизация 44100 или 48кгц.Эмуляция АУ прямо в ЦАПы по обработке каждого тика.Формирование цифрового потока идет асинхронно в буфер пачками по 1 тику плеера,вывод в ЦАПы через ДМА.Возможность плея цифрового эффекта в любой из 32 каналовс заданием громкости в обоих ушах (панорамирование), динамически,в том числе и во время проигрывания ХМ. Эффект играет в канале до егоокончания, паттерн данном канале игнорится до окончания эффекта (опционально).Суммирование каналов производится путем сложения амплитуд с обрезанием амплитуды по 0 и 255.Т.е. каждый из каналов играет с громкостью на весь ЦАП, а не 1/32, как в гс и нгс.Обязательная интерполяция выходного потока.Предлагается юзать линейную, как наиболее простую в реализации, и весьма эффективную.5. Possible issuesЕсли на 14мгц дрочить порты АУ зетником на макс скорости,проц должен адекватно на это реагировать, не тормозя, не вися, не глитчя.Предусмотреть ситуацию, когда [s]go sleep[/s] stupid user загрузит какое-нитьговно в плеер и даст плей. Т.е. защиту от дебила на всех возможных уровнях:инит модуля, выполнение команд и тд, и реагировать на это адекватным статусом.Если свершилось страшное и проц завис - спасает общий ресет.Бага такого рода лежит на разрабе и подлежит фиксу.Зависания в режиме АУ не должно быть в принципе.